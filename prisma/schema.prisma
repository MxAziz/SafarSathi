generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                 String     @id @default(uuid())
  email              String     @unique
  password           String
  role               UserRole   @default(TRAVELER)
  needPasswordChange Boolean    @default(true)
  gender             Gender?
  status             UserStatus @default(ACTIVE)
  isDeleted          Boolean    @default(false)
  isVerified         Boolean    @default(false)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  admin              Admin?
  traveler           Traveler?

  @@map("users")
}

model Admin {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  contactNumber String?
  address       String?
  profileImage  String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [email], references: [email])

  @@map("admins")
}

model Traveler {
  id                  String        @id @default(uuid())
  name                String
  email               String        @unique
  contactNumber       String?
  address             String?
  profileImage        String?
  bio                 String?
  travelInterests     String[]      @default([])
  visitedCountries    String[]      @default([])
  currentLocation     String?
  averageRating       Float         @default(0.0)
  isVerifiedTraveler  Boolean       @default(false)
  subscriptionEndDate DateTime?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  payments            Payment[]
  reviews             Review[]
  travelPlans         TravelPlan[]
  user                User          @relation(fields: [email], references: [email])
  tripRequests        TripRequest[]

  @@map("travelers")
}

model TravelPlan {
  id           String        @id @default(uuid())
  title        String
  description  String?
  destination  String
  imageUrl     String?
  startDate    DateTime
  endDate      DateTime
  budgetRange  String
  travelType   TravelType
  visibility   Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  travelerId   String
  reviews      Review[]
  traveler     Traveler      @relation(fields: [travelerId], references: [id])
  tripRequests TripRequest[]

  @@map("travelPlans")
}

model Review {
  id           String     @id @default(uuid())
  rating       Int
  comment      String?
  travelerId   String
  travelPlanId String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  travelPlan   TravelPlan @relation(fields: [travelPlanId], references: [id])
  traveler     Traveler   @relation(fields: [travelerId], references: [id])
}

model TripRequest {
  id           String        @id @default(uuid())
  travelPlanId String
  travelerId   String
  status       RequestStatus @default(PENDING)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  travelPlan   TravelPlan    @relation(fields: [travelPlanId], references: [id])
  traveler     Traveler      @relation(fields: [travelerId], references: [id])

  @@unique([travelPlanId, travelerId])
  @@map("tripRequests")
}

model Payment {
  id                 String        @id @default(uuid())
  amount             Float
  status             PaymentStatus
  subscription       String
  transactionId      String        @unique
  paymentGatewayData Json?
  travelerId         String
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  traveler           Traveler      @relation(fields: [travelerId], references: [id])
}

enum UserRole {
  ADMIN
  TRAVELER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  BLOCKED
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum TravelType {
  SOLO
  FAMILY
  FRIENDS
  COUPLE
  GROUP
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}
